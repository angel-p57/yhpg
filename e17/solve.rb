def pcount xs,ys,b
  d=xs.size
  dh=(d+1)/2
  xh=xs[0,dh].to_i(b)+(xs[0,dh]+xs[0,d/2].reverse<xs ? 1 : 0)
  yh=ys[0,dh].to_i(b)-(ys[0,dh]+ys[0,d/2].reverse>ys ? 1 : 0)
  yh-xh+1
end
def solve input
  # implement
  x,y,b=input.split(?,).map &:to_i
  y-=1
  xs,ys=[x,y].map{|e| e.to_s(b) }
  xd,yd=[xs,ys].map &:size
  xd==yd ?
    pcount(xs,ys,b) :
    (xd+1..yd-1).reduce(pcount(xs,(b-1).to_s(b)*xd,b)+pcount(?1+?0*(yd-1),ys,b)){|s,d|
      dh=(d+1)/2
      s+b**(dh-1)*(b-1)
    }
end

def test(n,input,expected)
  actual=solve(input).to_s
  puts "#{n}: "+(actual==expected ? "ok":"ng ( #{actual} against #{expected} for #{input} )")
end

# test cases below
test( 0, "12,34,5", "5" )
test( 1, "10,11,10", "0" )
test( 2, "1,100,3", "18" )
test( 3, "11,12,10", "1" )
test( 4, "12,13,10", "0" )
test( 5, "123,456,7", "33" )
test( 6, "38,274,14", "17" )
test( 7, "98,76543,2", "535" )
test( 8, "987,6543,2", "103" )
test( 9, "5057,5202,3", "2" )
test( 10, "98,76543,21", "589" )
test( 11, "987,6543,21", "264" )
test( 12, "1097,2889,11", "35" )
test( 13, "2764,6482,17", "132" )
test( 14, "16333,24085,8", "121" )
test( 15, "21759,67173,20", "114" )
test( 16, "32026,57805,22", "53" )
test( 17, "188318,407853,6", "523" )
test( 18, "51669,116065,30", "72" )
test( 19, "294104,515248,32", "216" )
test( 20, "444257,740280,15", "1316" )
test( 21, "645098,2741620,9", "2876" )
test( 22, "12345,987654321,2", "62684" )
test( 23, "2467130,8433468,2", "2902" )
test( 24, "323901,4712975,10", "4389" )
test( 25, "12345,987654321,36", "67446" )
test( 26, "3969344,4086910,24", "205" )
test( 27, "19743263,83912295,5", "11553" )
test( 28, "6349529,39870823,10", "6637" )
test( 29, "66160071,153732445,5", "5605" )
test( 30, "18799557,189007582,14", "33741" )
test( 31, "78547566,225312226,20", "18346" )
test( 32, "143084571,506549072,18", "62323" )
test( 33, "2099642384,2789567569,6", "14787" )
